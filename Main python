from flask import Flask, redirect, url_for, render_template, request, session, flash
from datetime import timedelta
from flask_sqlalchemy import SQLAlchemy

projet = Flask(__name__)
projet.secret_key = "hello"
projet.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///cuisine'
projet.config["SQLALCHEMY_TRACK_MODIFICATION"] = False
projet.permanent_session_lifetime = timedelta(minutes=5)

db = SQLAlchemy(projet)

class login(db.Model):
    _id = db.Column("id", db.Integer, primary_key=True)
    nom = db.Column(db.String(50))
    mdp = db.Column(db.String(50))

    def __init__ (self, nom, mdp):
        self.nom = nom
        self.mdp = mdp

#class ingredients(db.Model):
 #_id = db.Column("id", db.Integer)
    

@projet.route("/", methods=["POST", "GET"])
def id():
    if request.method == "POST":
        session.permanent = True
        utilisateur = request.form.get("nom")
        mot_de_passe = request.form.get("mdp")

        utilisateur_trv = login.query.filter_by(nom=utilisateur, mdp=mot_de_passe).first()

        if utilisateur_trv:
            #verifier le mot de passe
            return redirect(url_for("principal"))
        
        if not utilisateur or not mot_de_passe:
            flash("Veuillez saisir Ã  la fois le nom d'utilisateur et le mot de passe.")
            return redirect(url_for("id"))
        
        else:
            nv_utilisateur = login(nom = utilisateur, mdp = mot_de_passe)
            db.session.add(nv_utilisateur)
            db.session.commit()
            return redirect(url_for("principal"))

    else:
        return render_template("id.html")

@projet.route("/principal")
def principal():
    return render_template("principal.html")

if __name__ == "__main__":
    with projet.app_context():
        db.create_all()
    projet.run(debug=True)
